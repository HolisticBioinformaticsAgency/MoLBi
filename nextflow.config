profiles {

  local_singularity {
    process.executor       = 'local'
    singularity.enabled    = true
    singularity.autoMounts = true
    singularity.cacheDir   = "${baseDir}/containers"
    process.scratch        = false

    process {
      // sensible defaults
      cpus   = 4
      memory = '8 GB'
      time   = '12h'

      // heavy hitters
      withName: 'ALIGN_SAM'          { cpus = 16; memory = '32 GB'; time = '24h' }
      withName: 'SORT_INDEX'         { cpus = 8;  memory = '16 GB'; time = '12h' }

      // BWA Deduplication
      withName: 'DEDUP_MARKDUPS' { cpus = 4; memory = '16 GB'; time = '6h'
        containerOptions = "--env JAVA_TOOL_OPTIONS=-Xmx12g"
      }

      // QC
      withName: 'HSMETRICS'          { cpus = 4; memory = '8 GB'; time = '4h' }
    
      // VarDict family
      withName: 'VARDICT_SINGLE_RAW' { cpus = 8;  memory = '16 GB'; time = '24h' }
      withName: 'VARDICT_PAIRED_RAW' { cpus = 8;  memory = '16 GB'; time = '24h' }
      withName: 'VARDICT_TO_VCF'     { cpus = 2;  memory = '4 GB';  time = '4h'  }

      // CNVkit split
      withName: 'CNVKIT_REF'         { cpus = 2;  memory = '4 GB';  time = '2h'  }
      withName: 'CNVKIT_AMPLICON'    { cpus = 8;  memory = '16 GB'; time = '12h' }
      withName: 'CNVKIT_GENES'       { cpus = 2;  memory = '4 GB';  time = '2h'  }

      // MSI
      withName: 'MSIPRO_SCAN'        { cpus = 2;  memory = '2 GB';  time = '1h'  }
      withName: 'MSIPRO_MSI'         { cpus = 8;  memory = '16 GB';  time = '6h'  }

      // Polysolver — more resources + bigger Java heap; no custom binds
      withName: 'POLYSOLVER' {
        cpus = 8
        memory = '32 GB'
        time = '24h'
        stageInMode = 'copy'
        shell = ['/bin/bash', '-eu', '-o', 'pipefail']
        containerOptions = "--env JAVA_TOOL_OPTIONS=-Xmx28g"
      }

      // Bind-only tweaks for annotation tools
      withName: 'VEP_ANNOTATE' {
        containerOptions = "--bind /home/hle1/cg90_scratch2/liem/resources/refdata/vep_cache:/vep_cache"
      }
      withName: 'SNPEFF_ANNOTATE' {
        containerOptions = "--bind /home/hle1/cg90_scratch2/liem/resources/refdata/snpEff:/snpeff_data"
      }
      withName: 'SOMATIC_FILTER' {
        cpus = 2
        memory = '4 GB'
        time = '1h'
      }
      withName: 'PYTMB' {
        cpus = 4
        memory = '8 GB'
        time = '4h'
      }
    }
  }

  slurm_singularity {
    process.executor       = 'slurm'
    singularity.enabled    = true
    singularity.autoMounts = true
    singularity.cacheDir   = "${baseDir}/containers"
    process.scratch        = true

    process {
      executor = 'slurm'
      queue    = 'comp'
      // cluster-wide defaults
      cpus   = 4
      memory = '8 GB'
      time   = '12h'

      // heavy hitters
      withName: 'ALIGN_SAM'          { cpus = 16; memory = '32 GB'; time = '24h' }
      withName: 'SORT_INDEX'         { cpus = 8;  memory = '16 GB'; time = '12h' }

      // BWA Deduplication
      withName: 'DEDUP_MARKDUPS' { cpus = 4; memory = '16 GB'; time = '6h'
        containerOptions = "--env JAVA_TOOL_OPTIONS=-Xmx12g"
      }

      // QC
      withName: 'HSMETRICS'          { cpus = 4; memory = '8 GB'; time = '4h' }

      // VarDict
      withName: 'VARDICT_SINGLE_RAW' { cpus = 8;  memory = '16 GB'; time = '24h' }
      withName: 'VARDICT_PAIRED_RAW' { cpus = 8;  memory = '16 GB'; time = '24h' }
      withName: 'VARDICT_TO_VCF'     { cpus = 2;  memory = '4 GB';  time = '4h'  }

      // CNVkit split
      withName: 'CNVKIT_REF'         { cpus = 2;  memory = '4 GB';  time = '2h'  }
      withName: 'CNVKIT_AMPLICON'    { cpus = 8;  memory = '16 GB'; time = '12h' }
      withName: 'CNVKIT_GENES'       { cpus = 2;  memory = '4 GB';  time = '2h'  }

      // MSI
      withName: 'MSIPRO_SCAN'        { cpus = 2;  memory = '2 GB';  time = '1h'  }
      withName: 'MSIPRO_MSI'         { cpus = 8;  memory = '16 GB';  time = '6h'  }

      // Polysolver — more resources + bigger Java heap; no custom binds
      withName: 'POLYSOLVER' {
        cpus = 8
        memory = '32 GB'
        time = '24h'
        stageInMode = 'copy'
        shell = ['/bin/bash', '-eu', '-o', 'pipefail']
        containerOptions = "--env JAVA_TOOL_OPTIONS=-Xmx28g"
      }

      // Bind cache dirs inside the VEP/SnpEff containers
      withName: 'VEP_ANNOTATE' {
        containerOptions = "--bind /home/hle1/cg90_scratch2/liem/resources/refdata/vep_cache:/vep_cache"
      }
      withName: 'SNPEFF_ANNOTATE' {
        containerOptions = "--bind /home/hle1/cg90_scratch2/liem/resources/refdata/snpEff:/snpeff_data"
      }
      withName: 'SOMATIC_FILTER' {
        cpus = 2
        memory = '4 GB'
        time = '1h'
      }
      withName: 'PYTMB' {
        cpus = 4
        memory = '8 GB'
        time = '4h'
      }
    }
  }
}
